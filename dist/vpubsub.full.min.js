var t="object"==typeof global&&global&&global.Object===Object&&global,e="object"==typeof self&&self&&self.Object===Object&&self,n=(t||e||Function("return this")()).Symbol,o=Object.prototype,r=o.hasOwnProperty,c=o.toString,u=n?n.toStringTag:void 0;var i=Object.prototype.toString;var l="[object Null]",s="[object Undefined]",a=n?n.toStringTag:void 0;function f(t){return null==t?void 0===t?s:l:a&&a in Object(t)?function(t){var e=r.call(t,u),n=t[u];try{t[u]=void 0;var o=!0}catch(t){}var i=c.call(t);return o&&(e?t[u]=n:delete t[u]),i}(t):function(t){return i.call(t)}(t)}function v(t){return null!=t&&"object"==typeof t}var h="[object Symbol]";var b=Array.isArray,p=1/0,g=n?n.prototype:void 0,j=g?g.toString:void 0;function y(t){if("string"==typeof t)return t;if(b(t))return function(t,e){for(var n=-1,o=null==t?0:t.length,r=Array(o);++n<o;)r[n]=e(t[n],n,t);return r}(t,y)+"";if(function(t){return"symbol"==typeof t||v(t)&&f(t)==h}(t))return j?j.call(t):"";var e=t+"";return"0"==e&&1/t==-p?"-0":e}var d="[object AsyncFunction]",O="[object Function]",_="[object GeneratorFunction]",Q="[object Proxy]";function E(t){if(!function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}(t))return!1;var e=f(t);return e==O||e==_||e==d||e==Q}var m,S,k=(m=Object.getPrototypeOf,S=Object,function(t){return m(S(t))}),P="[object Object]",w=Function.prototype,C=Object.prototype,T=w.toString,F=C.hasOwnProperty,x=T.call(Object);var A=0;function $(t){var e,n=++A;return(null==(e=t)?"":y(e))+n}class U{constructor(){this._channels=Object.create(null)}static _getChannelEvent(t){const e=t.indexOf(".");return{channel:-1!==e?t.slice(0,e):"default",event:t.slice(e+1)}}_getEventQueue(t,e){e||({channel:t,event:e}=U._getChannelEvent(t));const n=this._channels[t]=this._channels[t]??Object.create(null),o=n[e]=n[e]??[];return{currentChannel:n,event:e,eventQueue:o}}trigger(t,...e){const{eventQueue:n,currentChannel:o}=this._getEventQueue(t),r=o["*"]??[],{eventQueue:c}=this._getEventQueue("*","*");for(const t of n)t.handler(...e);for(const n of r)n.handler(...e,t);for(const n of c)n.handler(...e,t)}request(t,...e){const{eventQueue:n,currentChannel:o}=this._getEventQueue(t),r=o["*"]??[],{eventQueue:c}=this._getEventQueue("*","*");return Promise.all(n.concat(r).concat(c).map((n=>{const o=n.handler(...e,t);return o&&E(o.then)?o:Promise.resolve(o)})))}on(t,e,n){const{eventQueue:o}=this._getEventQueue(t),r=$("vent-");if(!E(e))throw new Error(`Specified handler for channelEvent ${t} must be a function.`);return o.push({handler:e.bind(n||this),token:r}),r}once(t,e,n){const o=this.on(t,(()=>{this.off(t,o),e.apply(n||this,arguments)}))}off(t,e){const{currentChannel:n,event:o,eventQueue:r}=this._getEventQueue(t);n[o]=e?r.filter((t=>t.token!==e)):[]}}const q=new U;function G(t){return G.installed||(G.installed=!0,t.config.globalProperties.$vent=q,t.mixin({mounted(){const{vent:t}=this.$options;if(t&&function(t){if(!v(t)||f(t)!=P)return!1;var e=k(t);if(null===e)return!0;var n=F.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&T.call(n)==x}(t)){const e=new Map;for(const n of Object.keys(t)){const o=E(t[n])?t[n]:this[t[n]],r=q.on(n,o,this);e.set(n,r)}this._ventTokens=e}},beforeUnmount(){const{vent:t}=this.$options;if(t&&this._ventTokens){for(const[t,e]of this._ventTokens)q.off(t,e);delete this._ventTokens}}})),t}export{U as Vent,q as default,G as install,q as vent};
